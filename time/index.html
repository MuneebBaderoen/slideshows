<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Time</title>

		<link rel="stylesheet" href="../revealjs/css/reveal.css">
		<link rel="stylesheet" href="../revealjs/css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="../revealjs/lib/css/zenburn.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<!-- Introduction -->
				<section data-markdown>
					<textarea data-template>
						# Time
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						- Why _is_ this value this? it _was_ that...
						- What _happened_ that made this happen that made that happen?
					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						_When_ you ask a question, is just as important as the question itself

						Note:
						Am I sitting? What time does mariams kitchen close today?
					</textarea>
				</section>
				<section data-markdown data-transition="slide-in fade-out" >
					<textarea data-template>
						## Reasoning about code

						- Functional thinking
						- Beware: side effects
						- Being conscious of state and how we use it

					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						assert_equal f(x), f(x)

						Note:
						Uncle bob really exploded my mind with this one.
						Raise hands if you know uncle bob? 1000 internet points to each of you
					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						- Pure function
						- Impure function
						- Side effect

						Note:
						Raise hands if you know these already
					</textarea>
				</section>
				<section data-markdown data-transition="fade-in fade-out" data-separator-notes="^Note:">
					<textarea data-template>
						Pure function

						```ruby
						def square(x)
							x ** 2
						end
						```

						Note:
						Function that depends only on the parameters, no non-local variables
						Guaranteed same result for same parameters
						Does not mutate anything outside this scope
					</textarea>
				</section>
				<section data-markdown data-transition="fade-in fade-out" data-separator-notes="^Note:">
					<textarea data-template>
						Impure function

						```ruby
						def f(x)
						  @some_shared_variable+=x
						end
						```

						Note:
						Depends on non-local/external state
						Has side effects (external / shared mutations)
					</textarea>
				</section>
				<section data-markdown data-transition="fade-in fade-out"  data-separator-notes="^Note:">
					<textarea data-template>
						Impure function

						```ruby
						def add_numbers(x, y)
							ActiveRecord::Migration.drop_table(:users)
							x + y
						end
						```

						Note:
						Returning the same value doesnt mean a function is safe.
					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						Impure functions are like boxes of chocolates

						Note:
						To test these guys effectively, you need to mock things.
						Extensive mocking will highlight a tight coupling between components,
						or more explicitly excessive side effects.
					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						## Side effects

						- Difficult to test
						- Difficult to reproduce
						- Difficult to track
						- Difficult to reason

						Note:
						fixtures, mocks, click testing on the UI, Call a PO
					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						Side effects make your life difficult
					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						- Printing to screen (Hello world?)
						- Reassigning a variable
						- Making a network request
						- Writing to database

						Note:
						Basically, mutations of things, in place
					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						So basically everything useful ðŸ™ˆ
					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						Side effects are not normal.

						Note:
						Whats normal? we're conditioned to believe that code should have tons of variables
						scattered everywhere. That usefulness comes from making classes and instances of things.
						Conditioned to think that basic data structures are just things to attach to classes and instances of things

						I'll have a separate rant another day about why Object Orientation itself is not a bad pattern,
						but people teach it and understand it halfway without teaching/learning the consequences of it

						It's taught as if it is the only way to build things, and realistically...it just isnt.
					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						Whats so bad about side effects anyway?

						Note:
						Don't worry, Im not saying we should drop all our databases because side effects are bad.

						Side effects themselves are not the problem. Its the nature of the operations that have
						side effects to	be scattered, widespread, and writing to shared locations without gatekeepers.
					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						Correctness is hard, consistency is easy

						Note:
						Pause here for breathing and asking questions and talking about stuff
						How much do you know about Object Orientation?
					</textarea>
				</section>
				<section data-separator-notes="^Note:">
					<img class="stretch" src="./assets/nicholas_cage.gif" alt="LMGTFY"></img>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						##Recap

						- Side effects are difficult to:
							- predict, track, test and reproduce
						- Side effects are massively useful
						- Proliferous side effects will keep you awake at night

					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						## Recap

						- Pure functions will let you sleep at night
						- Isolating side effects is good
						- Correctness is hard, consistency is easy

						Note:
						Consistency is easy, you want as much of the code you write to be 100% reliable
						Correctness is hard, and matures over time
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						Okay, so we've been writing stateful code our entire lives
					</textarea>
				</section>
				<section>
					<p>We should be pretty good at effects of the side variety</p>
					<img class="stretch" src="./assets/jenga.gif" alt="LMGTFY"></img>
				</section>
				<section data-markdown>
					<textarea data-template>
						State over time is hard to track
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						## Reasoning about data

						- Intermediate states
						- Intermediate mutations
						- Time travel
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template data-separator-notes="^Note:">
						## Intermediate states

						| id        | Status |  Created at           | Updated at  |
						| ------------- |-------------| -----| ----|
						| 1 | initial | Today 10:01 | Today 10:01 |
						| 2 | striking | Yesterday 10:01 | Today 10:01 |

						Note:
						Where do we find this knowledge? Sumo. Metrics. What happens when we check the database? When we try to reproduce problems?
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						### created -> ( 1...n ) -> update
						---
						I'll get you coffee from the tap if you have an answer for this.
					</textarea>
				</section>
				<section data-markdown  data-separator-notes="^Note:">
					<textarea data-template>
						has_paper_trail?
						---
						You have to get me coffee from the tap if this was your answer

						Note:
						The versions table exists, and is written to during development. Production
						table is blank. So we have this functionality but we arent using it

						Show the gem website, the version controller, and the SQL queries

						The problem is that it saves a serialized ruby hash, which is difficult to query and report on.
						Its not nearly as useful as database integrity
					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						# Intermediate mutations

						- Balances as the aggregation of transactions
						- Total counters as the sum of increments
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						Some words I dont understand

						- Event sourcing
						- CQRS (Command Query Responsibility Segregation)
						- Datomic
						- Append only databases
					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						Strategy I've seen used before successfully (MSSQL)

						| id        | Status |  Effective from           | Effective to  | User
						| ------------- |-------------| -----| ----|
						| 1 | initial | Today 10:01 | 9999-12-31 23:59:59.999 | muneeb
						| 2 | initial | Yesterday 10:01 | 2018-01-13 10:02:29.300 | muneeb
						| 3 | striking | 2018-01-13 10:02:29.301 | 9999-12-31 23:59:59.999 | muneeb

						Note:
						Query the db with date comparisons for time travel, Query with equality for current state

						Pros:
						- Time travel through database
						- Snapshots without creating snapshot
						- Can make basically all screens time travel

						Cons:
						- Tables grow significantly faster (we have smart people to help with that)
						- R/W overheads to maintain the ability to time travel
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template data-separator-notes="^Note:">
						| id        | Status |  Created at           | Updated at  |
						| ------------- |-------------| -----| ----|
						| 1 | initial | Today 10:01 | Today 10:01 |
						| 2 | striking | Yesterday 10:01 | Today 10:01 |

					</textarea>
				</section>
				<section data-markdown data-separator-notes="^Note:">
					<textarea data-template>
						# Recap

						Store all intermediate states or store the mutations

						Note:
						If you want to sleep at night

						This effectively gives you time travel for any table.
						Simultaneous time travel on any table, means time travel your database

						This is how recompute balance can make it to the correct state, temporarily
					</textarea>
				</section>
				<section data-state="last_slide">
					<p>What is the index of the title slide?</p>
					<p>I'll get you coffee from the tap if you get it right.</p>
					<img class="stretch" src="./assets/over_9000.gif" alt="LMGTFY"></img>
				</section>
			</div>
		</div>

		<script src="../revealjs/lib/js/head.min.js"></script>
		<script src="../revealjs/js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				// Display controls in the bottom right corner
				controls: false,
				// Hash routing for slides
				history: true,
				// Display a presentation progress bar
				progress: true,
				// Display slide number
				slideNumber: true,

				dependencies: [
					// Zoom in and out with Alt+click
					{ src: '../revealjs/plugin/zoom-js/zoom.js', async: true },
					{ src: '../revealjs/plugin/markdown/marked.js' },
					{ src: '../revealjs/plugin/markdown/markdown.js' },
					{ src: '../revealjs/plugin/notes/notes.js', async: true },
					{ src: '../revealjs/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});

			window.hasShuffled = false;

			Reveal.addEventListener('last_slide', function( event ) {
				if(!window.hasShuffled){
					Reveal.shuffle()
					window.hasShuffled = true
				}
			})
		</script>
	</body>
</html>
